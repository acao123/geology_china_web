# 系统测试指南

## 🧪 功能测试清单

### 1. 登录功能测试

#### 测试步骤：
1. 访问 http://localhost:8000
2. 应该自动跳转到 `/denglu/xianshi/`
3. 查看验证码图片是否正常显示
4. 点击验证码图片，验证是否能刷新

#### 测试用例：

| 测试项 | 账号 | 密码 | 验证码 | 预期结果 |
|--------|------|------|--------|----------|
| 正确登录 | admin | admin888 | 正确 | 登录成功，跳转到仪表盘 |
| 错误密码 | admin | wrong | 正确 | 提示密码错误 |
| 错误验证码 | admin | admin888 | wrong | 提示验证码错误 |
| 空账号 | (空) | admin888 | 正确 | 提示信息不完整 |
| 禁用账号 | test | test123 | 正确 | （如果设置为禁用）提示账户封存 |

### 2. 仪表盘测试

登录成功后，验证：
- [ ] 显示4个统计卡片（勘察员、角色、导航、操作）
- [ ] 统计数字正确（2个用户、2个角色、4个导航）
- [ ] 快捷入口按钮可点击
- [ ] 最近操作记录表格显示
- [ ] 顶部显示用户名
- [ ] 退出按钮可用

### 3. 勘察员管理测试

访问 `/kanche/liebiao/`

#### 列表功能：
- [ ] 显示勘察员列表表格
- [ ] 显示2条初始数据（admin, test）
- [ ] 分页组件显示
- [ ] "新增勘察员"按钮显示

#### 新增功能：
1. 点击"新增勘察员"
2. 填写表单：
   - 登录标识: testuser
   - 显示名称: 测试用户
   - 联系电话: 13800138000
   - 电子邮箱: test@example.com
   - 密码: test123
   - 选择角色
3. 提交表单
4. 验证是否添加成功

#### 编辑功能：
1. 点击某个用户的"编辑"按钮
2. 修改显示名称
3. 提交
4. 验证修改是否生效

#### 删除功能：
1. 点击"删除"按钮
2. 确认删除
3. 验证用户是否被删除

### 4. 角色管理测试

访问 `/juese/liebiao/`

#### 列表功能：
- [ ] 显示角色列表
- [ ] 显示2个初始角色
- [ ] 显示角色代码、名称、等级、状态
- [ ] 显示导航权限

#### 新增角色：
1. 点击"新增角色"
2. 填写：
   - 角色代码: TEST_ROLE
   - 角色名称: 测试角色
   - 等级: 50
3. 选择导航权限（勾选菜单树）
4. 提交
5. 验证角色创建成功

#### 权限分配：
1. 编辑某个角色
2. 在菜单树中勾选/取消导航权限
3. 保存
4. 验证权限是否更新

### 5. 导航管理测试

访问 `/daohang/liebiao/`

#### 列表功能：
- [ ] 显示导航树形列表
- [ ] 显示4个初始导航项
- [ ] 树形结构正确展示

#### 新增导航：
1. 点击"新增导航"
2. 填写：
   - 导航标题: 测试导航
   - 导航编码: test_nav
   - 路由地址: /test/
   - 图标样式: layui-icon-test
   - 排序: 100
   - 状态: 显示
3. 选择父级导航（可选）
4. 提交
5. 验证导航创建成功

#### 删除导航：
1. 选择没有子导航的项
2. 点击删除
3. 确认
4. 验证删除成功

### 6. 权限控制测试

#### 测试未登录访问：
1. 退出登录
2. 直接访问 `/kanche/liebiao/`
3. 应该跳转到登录页

#### 测试角色权限：
1. 使用 test 账号登录
2. 访问各个管理页面
3. 验证是否根据角色权限控制访问

### 7. API接口测试

使用 curl 或 Postman 测试：

```bash
# 1. 获取验证码
curl http://localhost:8000/denglu/yanzhengma/ -o captcha.png

# 2. 获取勘察员数据
curl http://localhost:8000/kanche/shujuliu/?page=1&limit=10 \
  -H "Cookie: sessionid=YOUR_SESSION_ID"

# 3. 获取角色数据
curl http://localhost:8000/juese/shujuliu/?page=1&limit=10 \
  -H "Cookie: sessionid=YOUR_SESSION_ID"

# 4. 获取导航树数据
curl http://localhost:8000/daohang/shujuliu/ \
  -H "Cookie: sessionid=YOUR_SESSION_ID"
```

## 🔍 性能测试

### 1. 页面加载速度
- 登录页: < 1s
- 仪表盘: < 2s
- 列表页: < 2s

### 2. 并发测试

使用 Apache Bench:
```bash
ab -n 1000 -c 10 http://localhost:8000/denglu/xianshi/
```

## 🛡️ 安全测试

### 1. SQL注入测试
尝试在登录框输入：
```
' OR '1'='1
admin' --
```
应该被Django ORM过滤，无法注入

### 2. XSS测试
在用户名等字段输入：
```html
<script>alert('XSS')</script>
```
应该被模板自动转义

### 3. CSRF测试
尝试不带CSRF token提交表单，应该被拒绝

## 📋 测试报告模板

```
测试日期: _______________
测试人员: _______________
测试环境: _______________

功能测试结果:
- [ ] 登录功能: 通过/失败
- [ ] 仪表盘: 通过/失败
- [ ] 勘察员管理: 通过/失败
- [ ] 角色管理: 通过/失败
- [ ] 导航管理: 通过/失败
- [ ] 权限控制: 通过/失败

发现的问题:
1. _______________
2. _______________

建议:
1. _______________
2. _______________
```

## ✅ 自动化测试

运行Django测试：
```bash
python manage.py test kuangcang
```

## 🎯 验收标准

系统通过验收需满足：
- ✅ 所有功能测试通过
- ✅ 无安全漏洞
- ✅ 页面加载速度合格
- ✅ 无明显BUG
- ✅ 文档完整

---

**测试完成后请填写测试报告！**
